name: Integration tests

on:
#  #merge_group:
#  push:
#    branches: [ "main" ]
  workflow_dispatch:
    inputs:
      GIT_REF:
        description: 'Commit hash to run the tests'
        required: true
jobs:

  integration-test-run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:     ## @TODO REMOVE
          ref: ${{ github.event.inputs.GIT_REF }}

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          cache-dependency-path: smoke-test/go.sum
          go-version: '1.22'

#     (perhaps prefetching these should be considered)
#      - name: Download images
#        uses: actions/download-artifact@v4
#        with:
#          path: /tmp/images

      - name: Run integration tests
        working-directory: ci/it
        run: go test -v

